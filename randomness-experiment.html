<!doctype html>
<html>

<head>
    <title>Randomness Experiment</title>
    <script src="jspsych-5.0.3/jquery.min.js"></script>
    <script src="jspsych-5.0.3/jspsych.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-text.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-instructions.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-single-stim.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-multi-stim-multi-response.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-html.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-survey-likert.js"></script>
    <script src="functions.js"></script>
    <script src="instruction-blocks.js"></script> 
    <link href="jspsych-5.0.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>
</head>

<body>
</body>
<script>
// generate a random 15-character string for subject ID
var subject_id = jsPsych.randomization.randomID(15)

// pick a random condition for the subject at the start of the experiment
var condition = jsPsych.randomization.sample(['aware_predict', 'unaware_predict', 'unaware_no_predict'], 1)

// extra data to be added to each trial
jsPsych.data.addProperties({
    subject: subject_id,
    condition: condition
})

// define countdown block for practice trials (600 ms)
var countdown_slow = {
    type: 'multi-stim-multi-response',
    stimuli: ['3', '2', '1'],
    is_html: true,
    choices: [],
    prompt: 'Press "g" for ROCK, "h" for PAPER, or "b" for SCISSORS',
    timing_stim: [600, 600, 600],
    timing_response: 1800,
    response_ends_trial: false,
    data: {
        block_task: 'countdown_trial_practice'
    }
}

// define countdown block for part 1 (500 ms)
var countdown_trial_part1 = {
    type: 'multi-stim-multi-response',
    stimuli: ['3', '2', '1'],
    is_html: true,
    choices: [],
    prompt: 'Press "g" for ROCK, "h" for PAPER, or "b" for SCISSORS',
    timing_stim: [500, 500, 500],
    timing_response: 1500,
    response_ends_trial: false,
    data: {
        block_task: 'countdown_trial_part1'
    }
}

// define countdown block for part 2 (400 ms)
var countdown_trial_part2 = {
    type: 'multi-stim-multi-response',
    stimuli: ['3', '2', '1'],
    is_html: true,
    choices: [],
    prompt: 'Press "g" for ROCK, "h" for PAPER, or "b" for SCISSORS',
    timing_stim: [400, 400, 400],
    timing_response: 1200,
    response_ends_trial: false,
    data: {
        block_task: 'countdown_trial_part2'
    }
}

// define countdown block for part 3 (300 ms)
var countdown_trial_part3 = {
    type: 'multi-stim-multi-response',
    stimuli: ['3', '2', '1'],
    is_html: true,
    choices: [],
    prompt: 'Press "g" for ROCK, "h" for PAPER, or "b" for SCISSORS',
    timing_stim: [300, 300, 300],
    timing_response: 900,
    response_ends_trial: false,
    data: {
        block_task: 'countdown_trial_part3'
    }
}

// debugging, adjusts timing for all game status blocks
var game_timing = 1000;

/* The following ten blocks represent all possible game situations that a player can encounter
 * This approach lacks finesse but it gets the job done. There are 9 possible outcomes if a player
 * submits a response, and 1 outcome if they miss a response (automatic forfeit)
 *
 * FORMAT: PLAYERMOVE_against_COMPUTERMOVE
 * Uses HTML to bootstrap the single-stim plugin
 */
var rock_against_rock = {
    type: 'single-stim',
    is_html: true,
    stimulus: "<div class='left center-content'>" +
        "<p><strong>You</strong></p>" +
        "<img src='img/RPSimage1.png'></img>" +
        "</div>" +
        "<div class='right center-content'>" +
        "<p><strong>The Computer</strong></p>" +
        "<img src='img/RPSimage1.png'></img>" +
        "</div>",
    choices: [],
    timing_response: game_timing,
    response_ends_trial: false,
    data: {
        block_task: 'rock_against_rock',
        game_status: 'tie'
    }
}

var rock_against_paper = {
    type: 'single-stim',
    is_html: true,
    stimulus: "<div class='left center-content'>" +
        "<p><strong>You</strong></p>" +
        "<img src='img/RPSimage1.png'></img>" +
        "</div>" +
        "<div class='right center-content'>" +
        "<p><strong>The Computer</strong></p>" +
        "<img src='img/RPSimage2.png'></img>" +
        "</div>",
    choices: [],
    timing_response: game_timing,
    response_ends_trial: false,
    data: {
        block_task: 'rock_against_paper',
        game_status: 'lose'
    }
}

var rock_against_scissors = {
    type: 'single-stim',
    is_html: true,
    stimulus: "<div class='left center-content'>" +
        "<p><strong>You</strong></p>" +
        "<img src='img/RPSimage1.png'></img>" +
        "</div>" +
        "<div class='right center-content'>" +
        "<p><strong>The Computer</strong></p>" +
        "<img src='img/RPSimage3.png'></img>" +
        "</div>",
    choices: [],
    timing_response: game_timing,
    response_ends_trial: false,
    data: {
        block_task: 'rock_against_scissors',
        game_status: 'win'
    }
}

var paper_against_rock = {
    type: 'single-stim',
    is_html: true,
    stimulus: "<div class='left center-content'>" +
        "<p><strong>You</strong></p>" +
        "<img src='img/RPSimage2.png'></img>" +
        "</div>" +
        "<div class='right center-content'>" +
        "<p><strong>The Computer</strong></p>" +
        "<img src='img/RPSimage1.png'></img>" +
        "</div>",
    choices: [],
    timing_response: game_timing,
    response_ends_trial: false,
    data: {
        block_task: 'paper_against_rock',
        game_status: 'win'
    }
}

var paper_against_paper = {
    type: 'single-stim',
    is_html: true,
    stimulus: "<div class='left center-content'>" +
        "<p><strong>You</strong></p>" +
        "<img src='img/RPSimage2.png'></img>" +
        "</div>" +
        "<div class='right center-content'>" +
        "<p><strong>The Computer</strong></p>" +
        "<img src='img/RPSimage2.png'></img>" +
        "</div>",
    choices: [],
    timing_response: game_timing,
    response_ends_trial: false,
    data: {
        block_task: 'paper_against_paper',
        game_status: 'tie'
    }
}

var paper_against_scissors = {
    type: 'single-stim',
    is_html: true,
    stimulus: "<div class='left center-content'>" +
        "<p><strong>You</strong></p>" +
        "<img src='img/RPSimage2.png'></img>" +
        "</div>" +
        "<div class='right center-content'>" +
        "<p><strong>The Computer</strong></p>" +
        "<img src='img/RPSimage3.png'></img>" +
        "</div>",
    choices: [],
    timing_response: game_timing,
    response_ends_trial: false,
    data: {
        block_task: 'paper_against_scissors',
        game_status: 'lose'
    }
}

var scissors_against_rock = {
    type: 'single-stim',
    is_html: true,
    stimulus: "<div class='left center-content'>" +
        "<p><strong>You</strong></p>" +
        "<img src='img/RPSimage3.png'></img>" +
        "</div>" +
        "<div class='right center-content'>" +
        "<p><strong>The Computer</strong></p>" +
        "<img src='img/RPSimage1.png'></img>" +
        "</div>",
    choices: [],
    timing_response: game_timing,
    response_ends_trial: false,
    data: {
        block_task: 'scissors_against_rock',
        game_status: 'lose'
    }
}

var scissors_against_paper = {
    type: 'single-stim',
    is_html: true,
    stimulus: "<div class='left center-content'>" +
        "<p><strong>You</strong></p>" +
        "<img src='img/RPSimage3.png'></img>" +
        "</div>" +
        "<div class='right center-content'>" +
        "<p><strong>The Computer</strong></p>" +
        "<img src='img/RPSimage2.png'></img>" +
        "</div>",
    choices: [],
    timing_response: game_timing,
    response_ends_trial: false,
    data: {
        block_task: 'scissors_against_paper',
        game_status: 'win'
    }
}

var scissors_against_scissors = {
    type: 'single-stim',
    is_html: true,
    stimulus: "<div class='left center-content'>" +
        "<p><strong>You</strong></p>" +
        "<img src='img/RPSimage3.png'></img>" +
        "</div>" +
        "<div class='right center-content'>" +
        "<p><strong>The Computer</strong></p>" +
        "<img src='img/RPSimage3.png'></img>" +
        "</div>",
    choices: [],
    timing_response: game_timing,
    response_ends_trial: false,
    data: {
        block_task: 'scissors_against_scissors',
        game_status: 'tie'
    }
}

var missed_against_computer = {
    type: 'single-stim',
    is_html: true,
    stimulus: "<div class='left center-content'>" +
        "<p><strong>You</strong></p>" +
        "<p>TOO LATE!</p>" +
        "</div>" +
        "<div class='right center-content'>" +
        "<p><strong>The Computer</strong></p>" +
        "</div>",
    choices: [],
    timing_response: game_timing,
    response_ends_trial: false,
    data: {
        block_task: 'missed_against_computer',
        game_status: 'forfeit'
    }
}

var if_rock_against_rock = {
    timeline: [rock_against_rock],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == 71 && data.answer_status == 'answered' && data.computer_move == 1) {
            return true;
        } else {
            return false;
        }
    }
}

var if_rock_against_paper = {
    timeline: [rock_against_paper],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == 71 && data.answer_status == 'answered' && data.computer_move == 2) {
            return true;
        } else {
            return false;
        }
    }
}

var if_rock_against_scissors = {
    timeline: [rock_against_scissors],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == 71 && data.answer_status == 'answered' && data.computer_move == 3) {
            return true;
        } else {
            return false;
        }
    }
}

var if_paper_against_rock = {
    timeline: [paper_against_rock],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == 72 && data.answer_status == 'answered' && data.computer_move == 1) {
            return true;
        } else {
            return false;
        }
    }
}

var if_paper_against_paper = {
    timeline: [paper_against_paper],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == 72 && data.answer_status == 'answered' && data.computer_move == 2) {
            return true;
        } else {
            return false;
        }
    }
}

var if_paper_against_scissors = {
    timeline: [paper_against_scissors],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == 72 && data.answer_status == 'answered' && data.computer_move == 3) {
            return true;
        } else {
            return false;
        }
    }
}

var if_scissors_against_rock = {
    timeline: [scissors_against_rock],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == 66 && data.answer_status == 'answered' && data.computer_move == 1) {
            return true;
        } else {
            return false;
        }
    }
}

var if_scissors_against_paper = {
    timeline: [scissors_against_paper],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == 66 && data.answer_status == 'answered' && data.computer_move == 2) {
            return true;
        } else {
            return false;
        }
    }
}

var if_scissors_against_scissors = {
    timeline: [scissors_against_scissors],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == 66 && data.answer_status == 'answered' && data.computer_move == 3) {
            return true;
        } else {
            return false;
        }
    }
}

var if_missed_against_computer = {
    timeline: [missed_against_computer],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == -1) {
            return true;
        } else {
            var comp_move = computerRandomMove();
            jsPsych.data.addDataToLastTrial({
                computer_move: comp_move
            })
            return false;
        }
    }
}

var game_array = [
    rock_against_rock, rock_against_paper, rock_against_scissors,
    paper_against_rock, paper_against_paper, paper_against_scissors,
    scissors_against_rock, scissors_against_paper, scissors_against_scissors
]

/* The following seven blocks are used to display the break images, which are small comic strips
 * Subject is given one minute before trial moves on. Or they can press a key to advance if they are ready sooner.
 */
var break_one = {
    type: 'single-stim',
    stimulus: 'img/Breakim1.png',
    choices: [],
    prompt: '<strong>BREAK</strong>' + '<p>Please enjoy a one minute break.</p>' +
        '<p>Press any key when you are ready to continue</p>',
    timing_response: 60000, // wait 1 minute before continuing
    response_ends_trial: true, // end trial whenever participant presses a key
    data: {
        block_task: 'break_one'
    }
}

var break_two = {
    type: 'single-stim',
    stimulus: 'img/Breakim2.png',
    choices: [],
    prompt: '<strong>BREAK</strong>' + '<p>Please enjoy a one minute break.</p>' +
        '<p>Press any key when you are ready to continue</p>',
    timing_response: 60000, // wait 1 minute before continuing
    response_ends_trial: true, // end trial whenever participant presses a key
    data: {
        block_task: 'break_two'
    }
}

var break_three = {
    type: 'single-stim',
    stimulus: 'img/Breakim3.png',
    choices: [],
    prompt: '<strong>BREAK</strong>' + '<p>Please enjoy a one minute break.</p>' +
        '<p>Press any key when you are ready to continue</p>',
    timing_response: 60000, // wait 1 minute before continuing
    response_ends_trial: true, // end trial whenever participant presses a key
    data: {
        block_task: 'break_three'
    }
}

var break_four = {
    type: 'single-stim',
    stimulus: 'img/Breakim4.png',
    choices: [],
    prompt: '<strong>BREAK</strong>' + '<p>Please enjoy a one minute break.</p>' +
        '<p>Press any key when you are ready to continue</p>',
    timing_response: 60000, // wait 1 minute before continuing
    response_ends_trial: true, // end trial whenever participant presses a key
    data: {
        block_task: 'break_four'
    }
}

var break_five = {
    type: 'single-stim',
    stimulus: 'img/Breakim5.png',
    choices: [],
    prompt: '<strong>BREAK</strong>' + '<p>Please enjoy a one minute break.</p>' +
        '<p>Press any key when you are ready to continue</p>',
    timing_response: 60000, // wait 1 minute before continuing
    response_ends_trial: true, // end trial whenever participant presses a key
    data: {
        block_task: 'break_five'
    }
}

var break_six = {
    type: 'single-stim',
    stimulus: 'img/Breakim6.png',
    choices: [],
    prompt: '<strong>BREAK</strong>' + '<p>Please enjoy a one minute break.</p>' +
        '<p>Press any key when you are ready to continue</p>',
    timing_response: 60000, // wait 1 minute before continuing
    response_ends_trial: true, // end trial whenever participant presses a key
    data: {
        block_task: 'break_six'
    }
}

var break_seven = {
    type: 'single-stim',
    stimulus: 'img/Breakim7.png',
    choices: [],
    prompt: '<strong>BREAK</strong>' + '<p>Please enjoy a one minute break.</p>' +
        '<p>Press any key when you are ready to continue</p>',
    timing_response: 60000, // wait 1 minute before continuing
    response_ends_trial: true, // end trial whenever participant presses a key
    data: {
        block_task: 'break_seven'
    }
}

// define go block, collect response from subject
var go_trial = {
    type: 'single-stim',
    is_html: true,
    stimulus: 'GO!',
    choices: ['g', 'h', 'b'],
    timing_response: 500,
    response_ends_trial: true,
    data: {
        block_task: 'go_text'
    },
    on_finish: function(data) {
        if (data.key_press == -1) {
            jsPsych.data.addDataToLastTrial({
                answer_status: 'missed'
            });
        } else {
            jsPsych.data.addDataToLastTrial({
                answer_status: 'answered'
            });
        }
    }
}

// define missed block, flashes if subject took over 500 ms to respond in go block
var missed = {
    type: 'single-stim',
    is_html: true,
    stimulus: 'TOO LATE!',
    timing_response: 500,
    response_ends_trial: false,
    data: {
        block_task: 'missed_text'
    }
}

// conditional block to check if subject missed response
var if_missed = {
    timeline: [missed],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == -1) {
            return true;
        } else {
            return false;
        }
    }
}

// rock block, display the rock image for 500 ms
var show_rock_image = {
    type: 'single-stim',
    stimulus: 'img/RPSimage1.png',
    timing_response: 500,
    response_ends_trial: false,
    data: {
        block_task: 'rock_image'
    }
}

// paper block, display the paper image for 500 ms
var show_paper_image = {
    type: 'single-stim',
    stimulus: 'img/RPSimage2.png',
    timing_response: 500,
    response_ends_trial: false,
    data: {
        block_task: 'paper_image'
    }
}

// scissor block, display the scissor image for 500 ms
var show_scissor_image = {
    type: 'single-stim',
    stimulus: 'img/RPSimage3.png',
    timing_response: 500,
    response_ends_trial: false,
    data: {
        block_task: 'scissors_image'
    }
}

// conditional block, check if subject pressed 'g' for rock
var if_rock = {
    timeline: [show_rock_image],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == 71 && data.answer_status == 'answered') {
            return true;
        } else {
            return false;
        }
    }
}

// conditional block, check if subject pressed 'h' for paper
var if_paper = {
    timeline: [show_paper_image],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == 72 && data.answer_status == 'answered') {
            return true;
        } else {
            return false;
        }
    }
}

// conditional block, check if subject pressed 'b' for scissor
var if_scissor = {
    timeline: [show_scissor_image],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == 66 && data.answer_status == 'answered') {
            return true;
        } else {
            return false;
        }
    }
}

var debug_loop = {
    timeline: [
        countdown_slow, go_trial,
        if_missed_against_computer,
        if_rock_against_rock, if_rock_against_paper, if_rock_against_scissors,
        if_paper_against_rock, if_paper_against_paper, if_paper_against_scissors,
        if_scissors_against_rock, if_scissors_against_paper, if_scissors_against_scissors
    ],
    on_finish: function() {
        var data = jsPsych.data.getLastTrialData();
        jsPsych.data.addDataToLastTrial({
            trial_data: 'trial_two'
        });
    }
}

// practice block, loops until last trial is one of the RPS image blocks
var practice_loop = {
    timeline: [
        countdown_slow, go_trial, if_missed, if_rock, if_paper, if_scissor
    ],
    loop_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.block_task == 'rock_image' || data.block_task == 'paper_image' || data.block_task == 'scissors_image') {
            jsPsych.data.addDataToLastTrial({
                trial_data: 'practice'
            });
            return false;
        } else if (data.block_task == 'missed_text') {
            return true;
        }
    }
}

// trial 1 block, loops until last trial is one of the RPS image blocks
var trial1_loop = {
    timeline: [
        countdown_trial_part1, go_trial, if_missed, if_rock, if_paper, if_scissor
    ],
    loop_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.block_task == 'rock_image' || data.block_task == 'paper_image' || data.block_task == 'scissors_image') {
            jsPsych.data.addDataToLastTrial({
                trial_data: 'trial_one'
            });
            return false;
        } else if (data.block_task == 'missed_text') {
            return true;
        }
    }
}

// trial 2 block, loops until last trial is one of the RPS image blocks
var trial2_loop = {
    timeline: [
        countdown_slow, go_trial,
        if_missed_against_computer,
        if_rock_against_rock, if_rock_against_paper, if_rock_against_scissors,
        if_paper_against_rock, if_paper_against_paper, if_paper_against_scissors,
        if_scissors_against_rock, if_scissors_against_paper, if_scissors_against_scissors
    ],
    on_finish: function() {
        var data = jsPsych.data.getLastTrialData();
        jsPsych.data.addDataToLastTrial({
            trial_data: 'trial_two'
        });
    }
}

// trial 3 block, loops until last trial is one of the RPS image blocks
var trial3_loop = {
    timeline: [
        countdown_trial_part3, go_trial, if_missed, if_rock, if_paper, if_scissor
    ],
    loop_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.block_task == 'rock_image' || data.block_task == 'paper_image' || data.block_task == 'scissors_image') {
            jsPsych.data.addDataToLastTrial({
                trial_data: 'trial_three'
            });
            return false;
        } else if (data.block_task == 'missed_text') {
            return true;
        }
    }
}

var scale_1 = ["1 (Strongly Agree)", "2", "3", "4 (Neutral)", "5", "6", "7 (Strongly Disagree)"];

var survey_block = {
    type: 'survey-likert',
    questions: [
        "I am confident that I know what a random sequence is.",
        "I am able to create a long, random sequence of Rock, Paper, and Scissors at will.",
        "I am able to recognize a random sequence of Rock, Paper, and Scissors when I see one"
    ],
    labels: [scale_1, scale_1, scale_1],
    data: {
        block_task: 'likert_survey'
    }
}

var debug_block1 = {
    type: 'text',
    text: function() {
        var subjectB1Data = collectTrialOneSequence();
        return "<p>1 == Rock, 2 == Paper, 3 == Scissors </p>" +
            "<p>" + subjectB1Data.trial_one_sequence + "</p>";
    }
}

// displays the subject's performance at the end of the experiment
var debrief_block = {
    type: 'text',
    text: function() {
        var subjectData = getSubjectData();
        return "<p>You generated a total of " + subjectData.answered + " RPS events, and you missed " + subjectData.missed + " total events.</p>" +
            "<p>Total rock: " + subjectData.rock + "</p><p>Total paper: " + subjectData.paper + "</p><p>Total Scissor: " + subjectData.scissor + "</p>";
    }
}

// preliminary timeline prep
var timeline = [];
timeline.push(consent_block);
timeline.push(welcome_block);

timeline.push(instructions_block1);

// DEBUGGING PURPOSES: variables to quickly adjust how many trials for each block
var total_trials = 2;
var debug_trials = 10;

for (var i = 0; i < debug_trials; i++) {
    timeline.push(debug_loop);
}

// collects at LEAST five trials with 'answered' as their data tags
for (var i = 0; i < total_trials; i++) {
    timeline.push(practice_loop);
}

timeline.push(practice_over);

// same format as previous
for (var i = 0; i < total_trials; i++) {
    timeline.push(trial1_loop);
}

var break_array = [break_one, break_two, break_three, break_four, break_five, break_six, break_seven];
var shuffled_array = jsPsych.randomization.repeat(break_array, 2);

timeline.push(shuffled_array[0]);

/*Part 2 */
if (condition == 'aware') {
    timeline.push(instructions_block2a); //a= aware+predict
} else if (condition == 'unaware_predict') {
    timeline.push(instructions_block2b); //b= unaware+predict
} else if (condition == 'unaware_no_predict') {
    timeline.push(instructions_block2c); //b= unaware+no predict
}

// same format as previous
for (var i = 0; i < total_trials; i++) {
    timeline.push(trial2_loop);
}

timeline.push(shuffled_array[1]);

timeline.push(instructions_block3);

// same format as previous
for (var i = 0; i < total_trials; i++) {
    timeline.push(trial3_loop);
}

timeline.push(survey_block);

timeline.push(debrief_block);

timeline.push(debug_block1);

// start the experiment
jsPsych.init({
    timeline: timeline,
    default_iti: 100,
    on_finish: function() {
        jsPsych.data.displayData('json');
    }
});
</script>

</html>