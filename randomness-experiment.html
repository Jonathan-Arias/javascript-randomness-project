<!doctype html>
<html>

<head>
    <title>Randomness Experiment</title>
    <script src="jspsych-5.0.3/jquery.min.js"></script>
    <script src="jspsych-5.0.3/jspsych.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-text.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-instructions.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-single-stim.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-multi-stim-multi-response.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-html.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-survey-likert.js"></script>
    <link href="jspsych-5.0.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>
</head>

<body>
</body>
<script>
// generate a random 15-character string for subject ID
var subject_id = jsPsych.randomization.randomID(15)

// pick a random condition for the subject at the start of the experiment
var condition = jsPsych.randomization.sample(['aware_predict', 'unaware_predict', 'unaware_no_predict'], 1)

// extra data to be added to each trial
jsPsych.data.addProperties({
    subject: subject_id,
    condition: condition
})

// function to check for participant consent
var check_consent = function(elem) {
    if ($('#consent_checkbox').is(':checked')) {
        return true;
    } else {
        alert("If you wish to participate, you must check the box next to the statement 'I agree to participate in this study.'");
        return false;
    }
    return false;
}

// declare consent block
var consent_block = {
    type: 'html',
    url: "consent_page.html",
    cont_btn: "start",
    check_fn: check_consent
}

// define welcome message block (overview of experiment)
var welcome_block = {
    type: 'instructions',
    pages: [
        '<strong>Welcome to the experiment</strong> ' +
        '<br />In the <strong>first</strong> part of the experiment, you are asked to create a sequence of Rock, Paper, Scissors that is as random as possible.' +
        '<ul><li>   For Rock: press the letter "g" on the keyboard.' +
        '<li>       For Paper: press the letter "h" on the keyboard. ' +
        '<li>       For Scissors: press the letter "b" on the keyboard. </ul>' +
        'Please take a moment to locate these keys on your keyboard now and to remember the mapping of letters to rock, paper, and scissors. ' +
        '<p>At the beginning of each trial, you will see a 3-2-1 countdown on the screen, followed by a red "GO!" signal. ' +
        'You must press "g", "h", or "b" as soon as you see the go signal. You will only have half a second to enter your response. ' +
        'Most importantly, <em>please make a conscious effort to create a series of Rock, Paper and Scissors that is as random as possible. </em>' +
        'It might help you to visualize this task as casting a 3-faced die. You can also try to imagine a computer program that spits out "Rock!", "Paper!" or "Scissors!" at random, in an unpredictable fashion.' +
        'The 10 first trials will serve as practice, for you to get accustomed to the experimental environment. Then you will begin your random sequence generation. </p>' +
        '<p>In the <strong>second</strong> part of the experiment, you will play rounds of Rock-Paper-Scissors against the computer. Your goal is to win as many rounds as possible. Once again, you will have the three natural options "Rock", "Paper" and "Scissors" to choose from, which you will select by pressing the same keys as in part 1. </p>' +
        'Reminder: Rock beats Scissors, Scissors beat Paper, and Paper beats Rock. ' +
        'The winner of the game will be determined by the amount of points you end up with. Both yourself and the computer will be allotted 100 points before starting the game. You will both obtain or lose points in the following manner:' +
        '<ul><li>You win: you receive 1 point, and the computer loses 1 point.' +
        '<li>You tie: both scores remain the same' +
        '<li>You lose: you lose 1 point, and the computer receives 1 point. </ul>' +
        'This means that if you lose a round (example: you play Paper and the computer plays Scissors), not only will you lose a point but the computer will gain one. ' +
        'Again, you will see the 3-2-1 countdown and the red "GO!" appear on the screen. If you do not press one of the keys (G, H or B) within a half second of the red "GO!" appearing, you will lose one point but the computer will not gain a point. ' +
        '<p>The <strong>third</strong> part of the experiment will be exactly the same as the first part: you will again generate a sequence of Rock, Paper and Scissors that is as random and unpredictable as possible. To help you picture this once more, you can imagine that your iPod only contains three songs titled "Rock", "Paper" and "Scissors", and you hit the Shuffle button repeatedly so that the iPod chooses one of the songs at random each time. It is crucial in these two parts that you literally try to act like your iPod, or the die, or the computer algorithm and make your sequence completely random. </p>'
    ],
    show_clickable_nav: true
}

var scale_1 = ["1 (Strongly Agree)", "2", "3", "4 (Neutral)", "5", "6", "7 (Strongly Disagree)"];

var survey_block = {
    type: 'survey-likert',
    questions: ["I am confident that I know what a random sequence is.", "I am able to create a long, random sequence of Rock, Paper, and Scissors at will.", "I am able to recognize a random sequence of Rock, Paper, and Scissors when I see one"],
    labels: [scale_1, scale_1, scale_1]
}

// define instructions block for Part 1
var instructions_block1 = {
    type: 'instructions',
    pages: [
        'Welcome to Part <strong>ONE</strong> of the game. ' +
        '<br />Please generate a random sequence of 3 events "Rock", "Paper" and "Scissors". ' +
        '<br />You are asked to press the 3 buttons (G,H, or B) as randomly as possible. ' +
        '<br />(Note that: the "g" key represents "Rock", the "h" key represents "Paper", and the "b" key represents "Scissors". ' +
        '<br />We will begin with a practise round. Press "next" when you are ready. ',

        '<strong> PRACTICE BLOCK </strong>'
    ],
    show_clickable_nav: true
}

// define instructions block for Part 2a (aware_predict)
var instructions_block2a = {
    type: 'instructions',
    pages: [
        'This is now part <strong>TWO</strong> of the experiment',
        'You will be predicted...this is condition 2a',
        'GL and begin'
    ],
    show_clickable_nav: true
}

// define instructions block for Part 2b (unaware_predict)
var instructions_block2b = {
    type: 'instructions',
    pages: [
        'This is now part <strong>TWO</strong> of the experiment',
        'You will be predicted (but not told)...this is condition 2b',
        'GL and begin'
    ],
    show_clickable_nav: true
}

// define instructions block for Part 2c (unaware_no_predict)
var instructions_block2c = {
    type: 'instructions',
    pages: [
        'This is now part <strong>TWO</strong> of the experiment',
        'You will NOT be predicted...this is condition 2c',
        'GL and begin'
    ],
    show_clickable_nav: true
}

// define instructions block for Part 3
var instructions_block3 = {
    type: 'instructions',
    pages: [
        'Welcome to Part <strong>THREE</strong> of the game. ' +
        '<br />Please generate a random sequence of 3 events "Rock", "Paper" and "Scissors". ' +
        '<br />You are asked to press the 3 buttons (G,H, or B) as randomly as possible. ' +
        '<br />(Note that: the "g" key represents "Rock", the "h" key represents "Paper", and the "b" key represents "Scissors". '
    ],
    show_clickable_nav: true
}

// define countdown block for practice trials (600 ms)
var countdown_slow = {
    type: 'multi-stim-multi-response',
    stimuli: ['3', '2', '1'],
    is_html: true,
    choices: [],
    prompt: 'Press "g" for ROCK, "h" for PAPER, or "b" for SCISSORS',
    timing_stim: [600, 600, 600],
    timing_response: 1800,
    response_ends_trial: false,
    data: {
        block_task: 'countdown_slow_text'
    }
}

// define countdown block for part 1 (500 ms)
var countdown_trial_part1 = {
    type: 'multi-stim-multi-response',
    stimuli: ['3', '2', '1'],
    is_html: true,
    choices: [],
    prompt: 'Press "g" for ROCK, "h" for PAPER, or "b" for SCISSORS',
    timing_stim: [500, 500, 500],
    timing_response: 1500,
    response_ends_trial: false,
    data: {
        block_task: 'countdown_trial_part1'
    }
}

// define countdown block for part 2 (400 ms)
var countdown_trial_part2 = {
    type: 'multi-stim-multi-response',
    stimuli: ['3', '2', '1'],
    is_html: true,
    choices: [],
    prompt: 'Press "g" for ROCK, "h" for PAPER, or "b" for SCISSORS',
    timing_stim: [400, 400, 400],
    timing_response: 1200,
    response_ends_trial: false,
    data: {
        block_task: 'countdown_trial_part2'
    }
}

// define countdown block for part 3 (300 ms)
var countdown_trial_part3 = {
    type: 'multi-stim-multi-response',
    stimuli: ['3', '2', '1'],
    is_html: true,
    choices: [],
    prompt: 'Press "g" for ROCK, "h" for PAPER, or "b" for SCISSORS',
    timing_stim: [300, 300, 300],
    timing_response: 900,
    response_ends_trial: false,
    data: {
        block_task: 'countdown_trial_part3'
    }
}

// define go block, collect response from subject
var go_trial = {
    type: 'single-stim',
    is_html: true,
    stimulus: 'GO!',
    choices: ['g', 'h', 'b'],
    timing_response: 500,
    response_ends_trial: true,
    data: {
        block_task: 'go_text'
    },
    on_finish: function(data) {
        if (data.key_press == -1) {
            jsPsych.data.addDataToLastTrial({
                answer_status: 'missed'
            });
        } else {
            jsPsych.data.addDataToLastTrial({
                answer_status: 'answered'
            });
        }
    }
}

// define missed block, flashes if subject took over 500 ms to respond in go block
var missed = {
    type: 'single-stim',
    is_html: true,
    stimulus: 'TOO LATE!',
    timing_response: 500,
    response_ends_trial: false,
    data: {
        block_task: 'missed_text'
    }
}

// conditional block to check if subject missed response
var if_missed = {
    timeline: [missed],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == -1) {
            return true;
        } else {
            return false;
        }
    }
}

// rock block, display the rock image for 500 ms
var show_rock_image = {
    type: 'single-stim',
    stimulus: 'img/RPSimage1.png',
    timing_response: 500,
    response_ends_trial: false,
    data: {
        block_task: 'rock_image'
    }
}

// paper block, display the paper image for 500 ms
var show_paper_image = {
    type: 'single-stim',
    stimulus: 'img/RPSimage2.png',
    timing_response: 500,
    response_ends_trial: false,
    data: {
        block_task: 'paper_image'
    }
}

// scissor block, display the scissor image for 500 ms
var show_scissor_image = {
    type: 'single-stim',
    stimulus: 'img/RPSimage3.png',
    timing_response: 500,
    response_ends_trial: false,
    data: {
        block_task: 'scissors_image'
    }
}

// conditional block, check if subject pressed 'g' for rock
var if_rock = {
    timeline: [show_rock_image],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == 71 && data.answer_status == 'answered') {
            return true;
        } else {
            return false;
        }
    }
}

// conditional block, check if subject pressed 'h' for paper
var if_paper = {
    timeline: [show_paper_image],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == 72 && data.answer_status == 'answered') {
            return true;
        } else {
            return false;
        }
    }
}

// conditional block, check if subject pressed 'b' for scissor
var if_scissor = {
    timeline: [show_scissor_image],
    conditional_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.key_press == 66 && data.answer_status == 'answered') {
            return true;
        } else {
            return false;
        }
    }
}

// practice block, loops until last trial is one of the RPS image blocks
var practice_loop = {
    timeline: [
        countdown_slow, go_trial, if_missed, if_rock, if_paper, if_scissor
    ],
    loop_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.block_task == 'rock_image' || data.block_task == 'paper_image' || data.block_task == 'scissors_image') {
            jsPsych.data.addDataToLastTrial({
                block_task: 'practice_data'
            });
            return false;
        } else if (data.block_task == 'missed_text') {
            return true;
        }
    }
}

// trial 1 block, loops until last trial is one of the RPS image blocks
var trial1_loop = {
    timeline: [
        countdown_trial_part1, go_trial, if_missed, if_rock, if_paper, if_scissor
    ],
    loop_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.block_task == 'rock_image' || data.block_task == 'paper_image' || data.block_task == 'scissors_image') {
            jsPsych.data.addDataToLastTrial({
                block_task: 'trial1_data'
            });
            return false;
        } else if (data.block_task == 'missed_text') {
            return true;
        }
    }
}

// trial 2 block, loops until last trial is one of the RPS image blocks
var trial2_loop = {
    timeline: [
        countdown_trial_part2, go_trial, if_missed, if_rock, if_paper, if_scissor
    ],
    loop_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.block_task == 'rock_image' || data.block_task == 'paper_image' || data.block_task == 'scissors_image') {
            jsPsych.data.addDataToLastTrial({
                block_task: 'trial2_data'
            });
            return false;
        } else if (data.block_task == 'missed_text') {
            return true;
        }
    }
}

// trial 3 block, loops until last trial is one of the RPS image blocks
var trial3_loop = {
    timeline: [
        countdown_trial_part3, go_trial, if_missed, if_rock, if_paper, if_scissor
    ],
    loop_function: function() {
        var data = jsPsych.data.getLastTrialData();
        if (data.block_task == 'rock_image' || data.block_task == 'paper_image' || data.block_task == 'scissors_image') {
            jsPsych.data.addDataToLastTrial({
                block_task: 'trial3_data'
            });
            return false;
        } else if (data.block_task == 'missed_text') {
            return true;
        }
    }
}

// collects simple data about responses and returns totals for number of answered/missed and RPS selections
function getSubjectData() {
    var trials = jsPsych.data.getTrialsOfType('single-stim');

    var total_answered = 0;
    var total_missed = 0;
    var total_rock = 0;
    var total_paper = 0;
    var total_scissor = 0;
    for (var i = 0; i < trials.length; i++) {
        if (trials[i].answer_status == 'answered') {
            total_answered++;
            if (trials[i].key_press == 71) {
                total_rock++;
            } else if (trials[i].key_press == 72) {
                total_paper++;
            } else if (trials[i].key_press == 66) {
                total_scissor++;
            }
        } else if (trials[i].answer_status == 'missed') {
            total_missed++;
        }
    }
    return {
        rock: total_rock,
        paper: total_paper,
        scissor: total_scissor,
        answered: total_answered,
        missed: total_missed
    }
}

// displays the subject's performance at the end of the experiment
var debrief_block = {
    type: 'text',
    text: function() {
        var subjectData = getSubjectData();
        return "<p>You generated a total of " + subjectData.answered + " RPS events, and you missed " + subjectData.missed + " total events.</p>" +
            "<p>Total rock: " + subjectData.rock + "</p><p>Total paper: " + subjectData.paper + "</p><p>Total Scissor: " + subjectData.scissor + "</p>";
    }
}

// preliminary timeline prep
var timeline = [];
timeline.push(consent_block);
timeline.push(welcome_block);

timeline.push(survey_block);

timeline.push(instructions_block1);

// DEBUGGING PURPOSES: variable to quickly adjust how many trials for each block
var total_trials = 3;

// collects at LEAST five trials with 'answered' as their data tags
for (var i = 0; i < total_trials; i++) {
    timeline.push(practice_loop);
}

// displays after practice trial is complete
var practice_over = {
    type: 'text',
    text: 'Practice is over! Time for the real thing'
}

timeline.push(practice_over);

// same format as previous
for (var i = 0; i < total_trials; i++) {
    timeline.push(trial1_loop);
}

/*Part 2 */
if (condition == 'aware') {
    timeline.push(instructions_block2a); //a= aware+predict 
} else if (condition == 'unaware_predict') {
    timeline.push(instructions_block2b); //b= unaware+predict
} else if (condition == 'unaware_no_predict') {
    timeline.push(instructions_block2c); //b= unaware+no predict
}

// same format as previous
for (var i = 0; i < total_trials; i++) {
    timeline.push(trial2_loop);
}

timeline.push(instructions_block3);

// same format as previous
for (var i = 0; i < total_trials; i++) {
    timeline.push(trial3_loop);
}

timeline.push(debrief_block);

// start the experiment
jsPsych.init({
    timeline: timeline,
    default_iti: 100,
    on_finish: function() {
        jsPsych.data.displayData('csv');
    }
});
</script>

</html>
